(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{463:function(e,t,a){"use strict";a.r(t);var r=a(8),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"cluster-monitoring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cluster-monitoring"}},[e._v("#")]),e._v(" Cluster Monitoring")]),e._v(" "),a("h2",{attrs:{id:"instructions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#instructions"}},[e._v("#")]),e._v(" Instructions")]),e._v(" "),a("p",[e._v("Cadence is emitting metrics in both Server and client:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Follow this example to emit the "),a("a",{attrs:{href:"https://github.com/uber-common/cadence-samples/pull/36",target:"_blank",rel:"noopener noreferrer"}},[e._v("client side metrics for Golang client"),a("OutboundLink")],1),e._v(".")])]),e._v(" "),a("li",[a("p",[e._v("Follow this example to emit the "),a("a",{attrs:{href:"https://github.com/uber/cadence-java-samples/pull/44/files#diff-573f38d2aa3389b6704ede52eafb46a67d9aad2b478788eb4ccc3819958a405f",target:"_blank",rel:"noopener noreferrer"}},[e._v("client side metrics for Java client"),a("OutboundLink")],1),e._v(". Make sure you at least upgrade to 3.0.0.")])]),e._v(" "),a("li",[a("p",[e._v("For production, follow this "),a("a",{attrs:{href:"https://github.com/banzaicloud/banzai-charts/blob/master/cadence/templates/server-service-monitor.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("example of hemlchart"),a("OutboundLink")],1),e._v(" to emit server side metrics. Or you can follow "),a("a",{attrs:{href:"https://github.com/uber/cadence/blob/master/config/development_prometheus.yaml#L40",target:"_blank",rel:"noopener noreferrer"}},[e._v("the example of local environment"),a("OutboundLink")],1),e._v(" to Prometheus. All services need to expose a HTTP port to provide metircs like below")])])]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metrics")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("prometheus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("timerType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"histogram"')]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("listenAddress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0.0.0.0:8001"')]),e._v("\n")])])]),a("p",[e._v("The rest of the instructions are using local environment as an example.")]),e._v(" "),a("p",[e._v("For local server emitting metrics to Promethues, easies way is to use "),a("a",{attrs:{href:"https://github.com/uber/cadence/blob/master/docker/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker-compose"),a("OutboundLink")],1),e._v(" to start a local Cadence.")]),e._v(" "),a("p",[e._v("Make sure to update the "),a("code",[e._v("prometheus_config.yml")]),e._v(' to add "host.docker.internal:9098" to the scrape list before starting the docker-compose:')]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" 5s\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("external_labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("monitor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'cadence-monitor'")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("scrape_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'prometheus'")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# addresses to scrape")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'cadence:9090'")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'cadence:8000'")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'cadence:8001'")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'cadence:8002'")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'cadence:8003'")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'host.docker.internal:9098'")]),e._v("\n")])])]),a("p",[e._v("Note: "),a("code",[e._v("host.docker.internal")]),e._v(" "),a("a",{attrs:{href:"https://docs.docker.com/docker-for-mac/networking/#use-cases-and-workarounds",target:"_blank",rel:"noopener noreferrer"}},[e._v("may not work for some docker versions"),a("OutboundLink")],1)]),e._v(" "),a("ul",[a("li",[a("p",[e._v("After updating the prometheus_config.yaml as above, run "),a("code",[e._v("docker-compose up")]),e._v(" to start the local Cadence")])]),e._v(" "),a("li",[a("p",[e._v("Go the the sample repo, build the helloworld sample "),a("code",[e._v("make helloworld")]),e._v(" and run the worker "),a("code",[e._v("./bin/helloworld -m worker")]),e._v(", and then in another Shell start a workflow "),a("code",[e._v("./bin/helloworld")])])]),e._v(" "),a("li",[a("p",[e._v("Go to "),a("a",{attrs:{href:"http://localhost:9090/",target:"_blank",rel:"noopener noreferrer"}},[e._v("local Prometheus server"),a("OutboundLink")],1),e._v(" , you should be able to check the metrics handler from client/frontend/matching/history/sysWorker are all healthy as "),a("a",{attrs:{href:"http://localhost:9090/targets",target:"_blank",rel:"noopener noreferrer"}},[e._v("targets"),a("OutboundLink")],1),e._v(" "),a("img",{attrs:{width:"1192",alt:"Screen Shot 2021-02-20 at 11 31 11 AM",src:"https://user-images.githubusercontent.com/4523955/108606555-8d0dfb80-736f-11eb-968d-7678df37455c.png"}})])]),e._v(" "),a("li",[a("p",[e._v("Go to "),a("a",{attrs:{href:"http://localhost:3000",target:"_blank",rel:"noopener noreferrer"}},[e._v("local Grafana"),a("OutboundLink")],1),e._v(" , login as "),a("code",[e._v("admin/admin")]),e._v(".")])]),e._v(" "),a("li",[a("p",[e._v("Configure Prometheus as datasource: use "),a("code",[e._v("http://host.docker.internal:9090")]),e._v(" as URL of prometheus.")])]),e._v(" "),a("li",[a("p",[e._v("Import the "),a("RouterLink",{attrs:{to:"/docs/operation-guide/monitor/#grafana-dashboard-templates"}},[e._v("Grafana dashboard tempalte")]),e._v(" as JSON files.")],1)])]),e._v(" "),a("p",[e._v("Client side dashboard looks like this:\n"),a("img",{attrs:{width:"1513",alt:"Screen Shot 2021-02-20 at 12 32 23 PM",src:"https://user-images.githubusercontent.com/4523955/108607838-b7fc4d80-7377-11eb-8fd9-edc0e58afaad.png"}})]),e._v(" "),a("p",[e._v("And server basic dashboard:\n"),a("img",{attrs:{width:"1514",alt:"Screen Shot 2021-02-20 at 12 31 54 PM",src:"https://user-images.githubusercontent.com/4523955/108607843-baf73e00-7377-11eb-9759-e67a1a00f442.png"}})]),e._v(" "),a("img",{attrs:{width:"1519",alt:"Screen Shot 2021-02-20 at 11 06 54 AM",src:"https://user-images.githubusercontent.com/4523955/108606577-b169d800-736f-11eb-8fcb-88801f23b656.png"}}),e._v(" "),a("h2",{attrs:{id:"grafana-dashboard-templates"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#grafana-dashboard-templates"}},[e._v("#")]),e._v(" Grafana dashboard templates")]),e._v(" "),a("p",[e._v("This "),a("a",{attrs:{href:"https://github.com/uber/cadence-docs/tree/master/src/grafana/prometheus",target:"_blank",rel:"noopener noreferrer"}},[e._v("package"),a("OutboundLink")],1),e._v(" contains examples of Cadence dashboards with Prometheus.")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("Cadence-Client")]),e._v(" is the dashboard of client metrics, and a few server side metrics that belong to client side but have to be emitted by server(for example, workflow timeout).")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("Cadence-Server-Basic")]),e._v(" is the the basic server dashboard to monitor/navigate the health/status of a Cadence cluster.")])]),e._v(" "),a("li",[a("p",[e._v("Apart from the basic server dashboard, it's recommended to set up dashboards on different components for Cadence server: Frontend, History, Matching, Worker, Persistence, Archival, etc. Any "),a("a",{attrs:{href:"https://github.com/uber/cadence-docs",target:"_blank",rel:"noopener noreferrer"}},[e._v("contribution"),a("OutboundLink")],1),e._v(" is always welcome to enrich the existing templates or new templates!")])])]),e._v(" "),a("h2",{attrs:{id:"periodic-tests-canary-for-health-check"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#periodic-tests-canary-for-health-check"}},[e._v("#")]),e._v(" Periodic tests(Canary) for health check")]),e._v(" "),a("p",[e._v("It's recommended to run periodical test every hour on your cluster following this "),a("a",{attrs:{href:"https://github.com/uber/cadence/tree/master/canary",target:"_blank",rel:"noopener noreferrer"}},[e._v("package"),a("OutboundLink")],1),e._v(" to make sure a cluster is healthy.")])])}),[],!1,null,null,null);t.default=s.exports}}]);